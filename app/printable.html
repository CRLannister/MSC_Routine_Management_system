<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
    /* @page { 
        size: landscape;
    }
    body { 
        writing-mode: tb-rl;
    } */
    </style>
   <title>
       Printable Routine
   </title>
</head>
<body>
    
<script>

//comments haru:
// create element rather than document write....
// writing format for document file for word

//NOTE : .......Date ani time are hard coded ....for taking that from database or index.html we need to first store it as well in db....however if date and time are to be remained as it is...it seems fine...

//also data from main for only different table/routines name info only....

    const electron = require('electron');
    const {ipcRenderer} = electron;
    const { remote } = require('electron');
    let doc_dest = "";
    let doc_full_path = "";
    let table_name = "";
    // document.write('<div id = "a">');

    // let el_1_b = document.createElement("div");
    // el_1_b.id = "b";
    // document.body.appendChild(el_1_b);


    let el_1 = document.createElement("div");
    el_1.id = "a";
    document.body.appendChild(el_1);
    // document.getElementById("b").appendChild(el_1);


    
        // doc_dest = wordPath;
        // doc_full_path = doc_dest + Routine_name + ".doc";


    // document.write('<div align = "center">');
    let el_2 = document.createElement("div");
    el_2.align = "center";
    el_2.id = "heading";
    // el_2.innerHTML = "TRIBHUVAN UNIVERSITY  ";
    document.getElementById("a").appendChild(el_2);

    let el_3_1 = document.createElement("h4");
    el_3_1.innerHTML = "TRIBHUVAN UNIVERSITY  ";
    document.getElementById("heading").appendChild(el_3_1);

    // let el_3_2 = document.createElement("br");
    // document.getElementById("heading").appendChild(el_3_2);

    let el_3_3 = document.createElement("h4");
    el_3_3.innerHTML = "INSTITUTE OF ENGINEERING , PULCHOWK CAMPUS ";
    document.getElementById("heading").appendChild(el_3_3);

    // let el_3_4 = document.createElement("br");
    // document.getElementById("heading").appendChild(el_3_4);

    let el_3_5 = document.createElement("h4");
    el_3_5.innerHTML = "Department of Electronics and Computer Engineering  ";
    document.getElementById("heading").appendChild(el_3_5);

    // let el_3_6 = document.createElement("br");
    // document.getElementById("heading").appendChild(el_3_6);

    let el_3_6_1 = document.createElement("h4");
    el_3_6_1.id = "course_div_id";
    document.getElementById("heading").appendChild(el_3_6_1);

    let el_3_6_2 = document.createElement("u");
    el_3_6_2.id = "course_full_name";
    el_3_6_2.innerHTML = "";
    document.getElementById("course_div_id").appendChild(el_3_6_2);


    // let el_3_7 = document.createElement("br");
    // document.getElementById("heading").appendChild(el_3_7);

    let el_3_8 = document.createElement("div");
    el_3_8.id = "course_div";
    document.getElementById("heading").appendChild(el_3_8);

    let el_3_8_1 = document.createElement("h5");
    el_3_8_1.id = "course_type";
    el_3_8_1.innerHTML = "Class Routine of Batch :  ";
    document.getElementById("course_div").appendChild(el_3_8_1);


    let el_3_8_2 = document.createElement("b");
    el_3_8_2.id = "batch_id";
    el_3_8_2.innerHTML = "OKAy";
    document.getElementById("course_type").appendChild(el_3_8_2);

    let el_3_9 = document.createElement("div");
    el_3_9.id = "level_bef_table";
    document.getElementById("heading").appendChild(el_3_9);

    let el_3_9_1 = document.createElement("span");
    el_3_9_1.id = "level_id";
    el_3_9_1.style.display = "inline-block";
    el_3_9_1.style.width = "20%";
    el_3_9_1.innerHTML = "Level: Masters "
    document.getElementById("level_bef_table").appendChild(el_3_9_1);

    let el_3_9_2 = document.createElement("span");
    el_3_9_2.id = "Program_id";
    el_3_9_2.style.display = "inline-block";        
    el_3_9_2.style.width = "20%";
    el_3_9_2.innerHTML = "Program: "
    document.getElementById("level_bef_table").appendChild(el_3_9_2);

    let el_3_9_3 = document.createElement("span");
    el_3_9_3.id = "year_id";
    el_3_9_3.style.display = "inline-block";
    el_3_9_3.style.width = "20%";
    el_3_9_3.innerHTML = "Year: "
    document.getElementById("level_bef_table").appendChild(el_3_9_3);


    let el_3_9_4 = document.createElement("span");
    el_3_9_4.id = "part_id";
    el_3_9_4.style.display = "inline-block";
    el_3_9_4.style.width = "20%";
    el_3_9_4.innerHTML = "Part: "
    document.getElementById("level_bef_table").appendChild(el_3_9_4);




    // document.write('TRIBHUVAN UNIVERSITY  <br>  INSTITUTE OF ENGINEERING , PULCHOWK CAMPUS  <br>  Department of Computer and Electronics   Engineering  <br><br>');
    // let el_3 = document.createElement("div");
    // el_3.innerHTML = "TRIBHUVAN UNIVERSITY  "
    // document.body.appendChild(el_2);

    // document.write('</div>');
   

    // document.write('<table style="border-collapse: collapse;" cellpadding="15" border=1 id="top_table" align = "center">');
    
    let el_4 = document.createElement("table");
    el_4.style.borderCollapse = "collapse";
    // el_4.border-collapse = "collapse";

    el_4.cellpadding = 15;
    el_4.border = 1;
    el_4.id = "top_table";
    el_4.align = "center";
    document.getElementById("a").appendChild(el_4);

    // document.write('<tr>');
    let el_5 = document.createElement("tr");
    el_5.id = "top_row";
    document.getElementById("top_table").appendChild(el_5);

    // document.write('<th> ' + "Day/time" + '</th>');
    let el_6 = document.createElement("th");
    el_6.innerHTML = "Day/time";
    document.getElementById("top_row").appendChild(el_6);


    // document.write('<th> ' + "10:15-12:00" + '</th>');
    let el_7 = document.createElement("th");
    el_7.innerHTML = "10:15-12:00";
    document.getElementById("top_row").appendChild(el_7);

    // document.write('<th> ' + "1:00-2:45" + '</th>');
    let el_8 = document.createElement("th");
    el_8.innerHTML = "1:00-2:45";
    document.getElementById("top_row").appendChild(el_8);


    // document.write('</tr>');
    let table = document.getElementById('top_table');
    console.log("")

    let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
    const sqlite3 = require('sqlite3').verbose();
    let db_name = "dummydata.sqlite3";
    let db_Path = __dirname + "/" + db_name;
    let db = new sqlite3.Database(db_Path);
    let Batch_yr = 0;
    let Program_full_name = "C";
    let Program_acronym_name = "R";
    let Year_yr = 1999;
    let Part_yr = 2;


    //when control comes from main window to this window...then control sent to main process for data 

    ipcRenderer.send('print-to-Word2');


    //receiving data i.e table name from main process

    ipcRenderer.on('doc_name',(event, Routine_name) =>{
        table_name = Routine_name;
        // console.log(table_name);
        db.serialize(function () {

            let initial_sql_command = `SELECT Batch Batch, Program_full Program_full, Program_acronym Program_acronym, Year Year, Part Part from "${table_name}" WHERE Table_id = 1`;
            db.get(initial_sql_command,(err, row) => {
                if (err) {
                    return console.error(err.message);
                }
                Batch_yr = row.Batch;
                Program_full_name = row.Program_full;
                Program_acronym_name = row.Program_acronym;
                Year_yr = row.Year;
                Part_yr = row.Part;
                console.log(Year_yr);
                console.log(Part_yr);

                document.getElementById("course_full_name").innerHTML = Program_full_name;
                document.getElementById("batch_id").innerHTML = Batch_yr;
                document.getElementById("Program_id").innerHTML += Program_acronym_name ;
                document.getElementById("year_id").innerHTML += Year_yr.toString() ;
                document.getElementById("part_id").innerHTML += Part_yr.toString() ;

            });


            for(let i = 0; i< days.length; i++){
                let sqlCommand = `SELECT Teacher Teacher, Subject Subject from "${table_name}" WHERE Day = "${days[i]}"`;
                
                // console.log(table_name);

                //data for days column from this file...i.e hardcoded

                let newRow = table.insertRow(i + 1);
                    let newCell = newRow.insertCell(0);
                    let newText = document.createTextNode(days[i]);
                    newCell.appendChild(newText);
                    let k = 0;

                db.all(sqlCommand, [], (err, rows)=>{
                    if (err) {
                        throw err;
                    }
                    //inserting rows after rows...in the document from the routine table

                    rows.forEach((row)=>{
                        k++;
                        let newCell1 = newRow.insertCell(k);
                        teacher_name = document.createElement("p")
                        teacher_name.innerHTML = row.Teacher;
                        subject_name = document.createElement("p");
                        subject_name.innerHTML = row.Subject;
                        // let newText1 = document.createTextNode(row.Teacher +'\n' + row.Subject);
                        console.log(row.Teacher);
                        console.log(row.Subject);
                        // newCell1.appendChild(newText1);
                        newCell1.appendChild(teacher_name);
                        newCell1.appendChild(subject_name);

                        //this code for html file of document for line feed character to show effect

                        // document.body.style = "white-space: pre;"
                    })
                })
            }

        
            //ignoring this 2 lines as create element

            // document.write('</table>');
            // document.write('</div>');
        });
            
    });


    // exported function for converting the so build html file as doc_file to be a doc file.

    //NOTE: if there is enough time or if it is asked of us, to set path of the exported doc_file in the project directory..
    // then,..let's see afterwards....

    function exportHTML(table_name){
        let header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' " +
            "xmlns:w='urn:schemas-microsoft-com:office:word' " +
            "xmlns='http://www.w3.org/TR/REC-html40'>" +
            "<head><meta charset='utf-8'><title>Export HTML to Word Document with JavaScript</title></head><body>";
        let footer = "</body></html>";
        let sourceHTML = header + document.getElementById("a").innerHTML + footer;
        // document.body.style = "white-space: pre;"

        let source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        let fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        doc_name = table_name + ".docx";
        // doc_name = doc_full_path;
        fileDownload.download = doc_name;
        fileDownload.click();
        document.body.removeChild(fileDownload);
    }

    document.getElementById("cancelButton").onclick = function(e){
        ipcRenderer.send('closeWindow');
    }
</script>



<button id="btn-export" onclick="exportHTML(table_name);">Export to word doc</button>

<button class="waves-effect waves-light btn" type="reset" id="cancelButton">Cancel</button>


 

</body>
</html>
