<!DOCTYPE html>
<html>
    <head>
        <title>MSC_Routine_Generator</title>
        <link rel="stylesheet" href="index.css">
    </head>
    <body>
        <div>
            <div align="center">
            TRIBHUVAN UNIVERSITY<br>INSTITUTE OF ENGINEERING , PULCHOWK CAMPUS<br>Department of Computer and Electronics Engineering<br>
            <b>M.sc. Program</b>
            <h6 align='center' ><b id='dbName'>Database_enabled : </b><b id='dbVal'> </b> </h6>
            </div>
            <div align="center" class="batch">Class Routine of
                <select id="select_batch">
                        <option>2075</option>
                        <option>2074</option>
                        <option>2073</option>
                        <option>2072</option>
                        <option>2071</option>
                        <option>2070</option>
                </select>
                batch
            </div>

            <div class="mains">
                <b>
                    <div class="level_masters" align="center">Level : Masters</div>
                    <div class="program">Program
                        <select id="select_program">
                            <option></option>
                            <option>1</option>
                            <option>2</option>
                        </select>
                    </div>
                    <div class="year">Year
                        <select id="select_year">
                            <option></option>
                            <option>1</option>
                            <option>2</option>
                        </select>

                    </div>
                    <div class="part">Part
                        <select id="select_part">
                            <option></option>
                            <option>1</option>
                            <option>2</option>

                        </select>
                    </div>
                    <div class="effective_date">Effective from
                        <input type="date" id="select_date">

                    </div>
                </b>
            </div>
            <div class="second_info">
                <b>
                    <div class="time">Time
                        <!-- <input type="time" id="select_time"> -->
                        <input type="number" id="select_firsttime" min="1" max="12" value=00>
                        :
                        <input type="number" id="select_secondtime" min="0" max="59" value=0>
                        <select id="select_timeperiod">
                            <option>AM</option>
                            <option>PM</option>
                        </select>
                    </div>
        
                    <div class="_interval">Interval of each period
                        <!-- <select id="select_interval" onchange="func1()">
                            <option >30</option>
                            <option >45</option>
                            <option value=50>50</option>
                        </select> -->
                        <input type="number" id="select_interval" 
                        min="10" max="60" value=45>
                        mins
                        <button class="btn_settime" onclick="myFunction_settime()">Set Time</button>
                    </div>
                    <div class="_periods">No.of periods
                        <select id="select_periods">
                            <option>4</option>
                        </select>
                    </div>
                </b>
            </div>
        </div>

        <!--input type="file" id="dirOpen" webkitdirectory / -->
        <ul></ul>

        <ul id="database">
        </ul>
        <script>
            const electron = require('electron');
            const {ipcRenderer} = electron;
            
            var batch = document.getElementById("select_batch").value;
            var program=document.getElementById("select_program").value;
            var year=document.getElementById("select_year").value;
            var part=document.getElementById("select_part").value;
        
            var e=document.getElementById("select_periods");
            
            var date=document.getElementById("select_date").value;
            var isfirst=0;
            var first=0;
            var frst=0;
            var storez;
            var arr=["sub1","sub2","sub3","sub4","sub5","sub6"];
            var days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];
            var demoo=["demo0","demo1","demo2","demo3","demo4"];
            //         e.onchange = function() {
            //     var strUser = e.options[e.selectedIndex].value;
                
            // }
            document.write('<table border=1 class="top_table">');
        
            document.write('<tr>');
            for(var k=0;k<5;k++){
                if (isfirst==0){
                    document.write('<th> '+"Day/time"+'</th>');
                    isfirst=1;  
                }
                else{
                    document.write('<th width="25%">');
                        
                    if(k==1){
                        document.write('<p id="demo1"></p>');
                    }
                    else if(k==2){
                        document.write('<p id="demo2"></p>');
                    }
                    else if(k==3){
                        document.write('<p id="demo3"></p>');
                    }
                    else if(k==4){
                        document.write('<p id="demo4"></p>');
                    }
        
                    document.write('</th>');
                }         
            }

            document.write('</tr>');

            for(var i=0;i<days.length;i++){
                // document.write('<tr><td>'+days[i]+'</td></tr>');
                document.write('<tr>');
                for(var j=0;j<3;j++){
                    if(first==0){
                        document.write('<td>'+days[i]+'</td>');
                        first=1;
                    }
                    else{
                        document.write('<td colspan=2 width="50%">'); 
                        document.write('<table border=1 width="320" class="tabb">');
                        for(var l=0;l<2;l++){
                            if (frst==0){
                                document.write('<tr>');
                                document.write('<td>');
                                document.write('<select style="width: 106%" class="select_subject" id="select_subject" >');
                                document.write('<option></option>'); 
                                
                                document.write('</select>');
                                document.write('</td>');
                                document.write('</tr>');
                                frst=1;
                            }
                            else{
                                document.write('<tr>');
                                document.write('<td width="50%">');
                                document.write('<select style="width: 106%" id="select_teacher">');
                                document.write('<option>'+""+'</option>');  
                                
                    
                                document.write('</select>');
                                document.write('</td>')
                                document.write('</tr>');
                                frst=0;
                            }              
                        }

                        document.write('</table>');
                        document.write('</td>');
                    } 
                }
                first=0;
                document.write('</tr>');
            
            }
            
            document.write('</table>');
        
            function myFunction_settime(){
                var first_time=document.getElementById("select_firsttime").value;
                var second_time=document.getElementById("select_secondtime").value;
                var interval=document.getElementById("select_interval").value;
                var time_period=document.getElementById("select_timeperiod").value;
                if(interval==NaN){
                    interval=0;
                }
                
                if(second_time<10){
                    second_time="0"+second_time;
                }
                
                for(var i=1;i<=4;i++){        
                    var new_time=parseInt(second_time)+parseInt(interval);
                    if(new_time>59){
                        var subb=new_time-60;
                        
                        if(first_time<12){
                            storez=first_time;
                            first_time++;
                        }
                        else{
                        storez=first_time;
                        first_time=1;
                        }
                        if(subb<10 && subb>=0){
                        subb="0"+subb;     
                        }
                        document.getElementById("demo"+i).innerHTML = storez+":"+second_time+"-"+first_time+":"+subb+" "+time_period;
                        second_time=subb;
                    }
                    else{
                        document.getElementById("demo"+i).innerHTML = first_time+":"+second_time+"-"+first_time+":"+new_time+" "+time_period;
                        second_time=new_time;

                    }
                }
            }

            // ipcRenderer.on('dir:open', (event, arg) => {
            //     document.getElementById('dirOpen').click(function(){

            //     })
            // });



            function dropDown (db){
                let sqlCommandTeacher = `SELECT DISTINCT Name Name FROM Teacher`;
                let teacherList = document.getElementById('select_teacher');
                db.all(sqlCommandTeacher, [], (err, rows) => {
                    if (err) {
                        throw err;
                    }
                    rows.forEach((row) => {
                        const option = document.createElement('option');
                        const optionText = document.createTextNode(row.Name);
                        option.appendChild(optionText);
                        teacherList.appendChild(option);
                    });
                });

                let sqlCommandSubject = `SELECT DISTINCT Name Name FROM Subject`;
                let subjectList = document.getElementById('select_subject');
                db.all(sqlCommandSubject, [], (err, rows) => {
                        if (err) {
                            throw err;
                        }
                        rows.forEach((row) => {
                            const option = document.createElement('option');
                            const optionText = document.createTextNode(row.Name);
                            option.appendChild(optionText);
                            subjectList.appendChild(option);
                        });
                    });

            }

        
            var sqlite3 = require('sqlite3').verbose();
            var db;
            var bfr;

            function dbInitialize(file_val){
                document.getElementById('dbVal').innerHTML = file_val ;
            }

            ipcRenderer.on('open:Db', (event, old_Dbname) => {
                dbInitialize(old_Dbname);
                db = new sqlite3.Database(old_Dbname);;
            });

            ipcRenderer.on('DataBase:Create', (event, db_name ,db_dir_prefix) => {
                var file_full_path = db_dir_prefix+ '/databases/'+db_name + ".sqlite3";
                console.log(file_full_path);
                db= new sqlite3.Database(file_full_path);
                dbInitialize(db_name);
                db.serialize(function () {
                    db.run("CREATE TABLE Teacher(`Id`	INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,`Name`	TEXT NOT NULL,`Initials`	TEXT NOT NULL UNIQUE)");
                    db.run("CREATE TABLE Subject (`Id`	INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,`Name`	TEXT NOT NULL UNIQUE)");
                
                })
                dropDown(db);
            });

            ipcRenderer.on('Teacher:Store',(event,teacher_name,teacher_initials) => {
                db.serialize(function () {
                    db.run("INSERT INTO Teacher(`Name`,`Initials`) VALUES ( '"+teacher_name+"','"+teacher_initials+"')");
                    db.each("SELECT * FROM Teacher", function (err, row) {
                        console.log(row);
                    });
                })
            });

            ipcRenderer.on('Subject:Store',(event,Subject_name) => {
                db.serialize(function () {
                    db.run("INSERT INTO Subject (`Name`) VALUES ( '"+Subject_name+"')");
                })

            });

            ipcRenderer.on('DataBase:append', (event, db_name ,db_dir_prefix) => {
                var file_full_path = db_dir_prefix+ '/databases/'+db_name + ".sqlite3";
                console.log(file_full_path);
                db= new sqlite3.Database(file_full_path);
                dbInitialize(db_name);
                db.serialize(function () {
                                    
                })
                dropDown(db);
            });

            //dropdown
            

            //dropdown
            

        </script>

    </body>

</html>
